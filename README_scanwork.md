# 工厂报工管理系统

基于 FastAdmin 框架开发的工厂生产报工管理系统，实现从订单录入到员工报工的全流程数字化管理。

## 系统架构

- **后端框架**: FastAdmin (基于 ThinkPHP 5.1)
- **前端框架**: Bootstrap + jQuery
- **数据库**: MySQL
- **表前缀**: `fa_scanwork_`

## 功能模块

### 第一阶段：基础数据模块

#### 1. 产品与型号管理
- **产品管理**: 新增/编辑/删除产品，支持产品名称、规格管理
- **型号管理**: 为产品添加具体型号，支持型号描述
- **关联关系**: 产品与型号为 1对多 关系

#### 2. 工序与工价管理
- **工序管理**: 新增/编辑/删除工序，支持工序描述
- **工价设置**: 为"型号+工序"绑定工价，支持批量设置
- **唯一约束**: 同一型号的同一工序只能设置一个工价

### 第二阶段：订单与分工模块

#### 3. 订单管理
- **订单录入**: 录入订单号、客户信息，选择产品型号并填写数量
- **订单列表**: 展示所有订单，包含订单状态跟踪
- **订单详情**: 查看订单完整信息和分工进度
- **状态管理**: 订单状态自动更新（待生产→生产中→已完成）

#### 4. 分工分配
- **任务分配**: 选择订单→型号→工序→员工，分配生产任务
- **分配列表**: 展示所有分配记录，包含进度跟踪
- **批量分配**: 支持批量分配多个型号的多个工序
- **数据校验**: 确保分配的型号属于订单，工序有对应工价

### 第三阶段：报工与进度模块

#### 5. 报工管理
- **员工端报工**: 员工查看自己的任务，提交报工记录
- **管理端确认**: 管理员确认报工记录，自动计算工资
- **扫码报工**: 通过扫描二维码快速报工
- **报工验证**: 验证报工数量不超过分配数量

#### 6. 生产进度可视化
- **实时看板**: 显示今日报工数量、工资总额等关键指标
- **进度图表**: 使用ECharts展示订单进度、员工工作量等统计图表
- **趋势分析**: 日报工趋势、工序效率等数据分析
- **多维度统计**: 订单状态、员工工作量、工序效率等多维度统计

#### 7. 计件工资自动计算
- **工资计算**: 根据报工数量和工序工价自动计算工资
- **工资统计**: 按员工、时间等维度统计工资
- **工资明细**: 查看详细的工资计算明细
- **实时更新**: 报工确认后实时更新相关数据

## 安装部署

### 1. 数据库配置
执行 `scanwork_tables.sql` 文件创建数据表：

```sql
-- 导入数据库表结构
mysql -u username -p database_name < scanwork_tables.sql
```

### 2. 文件部署
将以下目录复制到 FastAdmin 项目中：

```
application/admin/controller/scanwork/     # 控制器
application/admin/model/scanwork/          # 模型
application/admin/view/scanwork/           # 视图
```

### 3. 权限配置
在 FastAdmin 后台添加菜单和权限：

- 产品管理: `scanwork/product`
- 型号管理: `scanwork/model`
- 工序管理: `scanwork/process`
- 工序工价: `scanwork/processprice`
- 订单管理: `scanwork/order`
- 分工分配: `scanwork/allocation`
- 报工管理: `scanwork/report`
- 生产进度: `scanwork/progress`
- 员工端报工: `index/worker/*` (使用FastAdmin用户中心)
- 二维码管理: `scanwork/qrcode`

## 使用说明

### 产品管理
1. 进入"产品管理"页面
2. 点击"添加"按钮新增产品
3. 填写产品名称和规格信息
4. 保存后可在型号管理中为该产品添加型号

### 型号管理
1. 进入"型号管理"页面
2. 点击"添加"按钮新增型号
3. 选择所属产品，填写型号名称和描述
4. 保存后可在工序工价中设置该型号的工序工价

### 工序管理
1. 进入"工序管理"页面
2. 点击"添加"按钮新增工序
3. 填写工序名称和描述信息
4. 保存后可在工序工价中设置该工序的工价

### 工序工价管理
1. 进入"工序工价管理"页面
2. 可单独添加或使用"批量设置工价"功能
3. 批量设置：选择型号，为所有工序设置工价
4. 系统会自动检查重复设置并提示

### 订单管理
1. 进入"订单管理"页面
2. 点击"添加"按钮新增订单
3. 填写客户信息，选择型号并设置数量
4. 保存后可在分工分配中为该订单分配任务

### 分工分配
1. 进入"分工分配"页面
2. 可单独添加或使用"批量分配"功能
3. 选择订单→型号→工序→员工，设置分配数量
4. 系统会自动验证数据完整性和数量限制

### 报工管理
1. 进入"报工管理"页面查看所有报工记录
2. 管理员可确认报工记录，系统自动计算工资

### 员工端报工
1. 员工访问前台地址：`http://域名/index/worker/index`
2. 使用FastAdmin用户中心账号登录系统
3. 在"我的任务"页面查看分配的任务
4. 点击"报工"按钮提交报工记录
5. 支持扫码报工和手动报工两种方式
6. 可查看个人报工记录和工资统计

### 生产进度可视化
1. 进入"生产进度"页面查看实时数据
2. 包含订单状态、员工工作量、工序效率等图表
3. 支持按时间范围查询日报工趋势
4. 提供详细的订单进度表格

### 工资统计
1. 进入"报工管理"→"工资统计"页面
2. 选择时间范围和员工进行查询
3. 查看员工工资汇总和详细明细
4. 支持导出工资统计数据

### 二维码管理
1. 进入"二维码管理"页面查看所有任务
2. 选择任务生成对应的二维码
3. 支持批量生成多个任务的二维码
4. 可下载二维码图片或打印二维码标签
5. 二维码包含完整的任务信息，便于扫码报工

### 扫码报工
1. 员工在前台"扫码报工"页面
2. 支持摄像头扫码和手动输入两种方式
3. 扫描二维码后自动识别任务信息
4. 输入报工数量后提交报工记录
5. 支持移动端摄像头扫码功能

## 技术特点

1. **模块化设计**: 按业务功能模块化开发，便于维护
2. **数据完整性**: 通过外键约束和业务逻辑确保数据一致性
3. **用户友好**: 直观的界面设计和操作流程
4. **扩展性强**: 基于 FastAdmin 框架，便于功能扩展
5. **移动端适配**: 响应式设计，完美支持手机和平板
6. **二维码集成**: 支持二维码生成、扫码报工功能
7. **前端优化**: 独立的JS文件，代码复用和维护性更好

## 开发计划

- [x] 第一阶段：基础数据模块
- [x] 第二阶段：订单与分工模块
- [x] 第三阶段：报工与进度模块
- [x] 第四阶段：二维码扫码功能
- [x] 第五阶段：移动端适配

、前端菜单建议
1. 工人端页面菜单（举例）
你可以在工人端导航栏或首页添加如下入口：
我的计时分工任务：/index/worker/ttasks
计时报工：/index/worker/treport
我的计时报工记录：/index/worker/trecords
我的计时工资统计：/index/worker/twage
<ul class="nav nav-pills">
  <li><a href="/index/worker/ttasks">计时分工任务</a></li>
  <li><a href="/index/worker/treport">计时报工</a></li>
  <li><a href="/index/worker/trecords">计时报工记录</a></li>
  <li><a href="/index/worker/twage">计时工资统计</a></li>
</ul>


计件报工模块详细页面说明
1. 我的计件分工任务页面
主要功能
展示员工当前所有“计件分工”任务。
每条任务显示：订单号、产品、型号、工序、分配数量、已报数量、待报数量、状态、分配时间等。
提供“报工”按钮，跳转到报工页面。
字段说明
订单号：本任务所属订单编号。
产品/型号/工序：本任务对应的产品、型号、工序名称。
分配数量：管理员分配给你的总件数。
已报数量：你已报工并审核通过的数量。
待报数量：剩余可报工的数量（分配数量-已报数量）。
状态：进行中/已完成。
分配时间：任务分配的时间。
典型操作
查看所有待报工任务。
点击“报工”按钮，进入报工页面。
2. 计件报工页面
主要功能
员工选择分工任务，填写本次报工数量，提交报工。
字段说明
选择分工任务：下拉选择你要报工的任务（如有多个）。
报工数量：本次实际完成的件数，不能超过待报数量。
备注：可选，填写特殊说明。
提交报工：点击后提交，等待后台审核。
典型操作
选择要报工的任务。
填写本次完成的数量（如50件）。
填写备注（如有）。
点击“提交报工”。
系统提示“报工提交成功，等待审核”。
3. 我的计件报工记录页面
主要功能
展示员工所有计件报工记录及审核状态。
字段说明
报工时间：提交报工的时间。
订单号/产品/型号/工序：本次报工对应的任务信息。
报工数量：本次报工的件数。
工价：该工序的计件单价。
工资金额：本次报工获得的工资（报工数量×工价）。
状态：待确认/已确认/已拒绝。
备注：管理员或本人填写的备注。
典型操作
查看每次报工的审核进度和工资金额。
如被拒绝，可联系管理员说明原因。
4. 我的计件工资统计页面
主要功能
展示员工每天的计件工资汇总。
字段说明
日期：工资统计的日期。
报工总数量：当天所有已审核通过的报工数量。
总工资金额：当天所有已审核通过的工资总额。
明细表格：可查看每条报工的详细信息。
典型操作
按日期筛选，查看某天/某月的工资。
导出工资明细（如有导出功能）。
典型业务流程（员工视角）
登录系统，进入“我的计件分工任务”页面，查看待报工任务。
点击“报工”，填写本次完成数量，提交。
等待管理员审核。
审核通过后，工资自动汇总到“我的计件工资统计”页面。
可随时查看历史报工记录和工资明细。
典型业务流程（管理员视角）
在后台维护产品、型号、工序、工价等基础数据。
在“分工分配”页面为员工分配计件任务。
在“报工管理”页面审核员工报工，点击“审核通过”或“拒绝”。
审核通过后，系统自动汇总工资到“工资统计”页面。
可导出工资数据，进行发薪或统计分析。
常见问题与建议
报工数量不能超过分配数量，系统自动校验。
工价必须维护，否则工资无法自动计算。
审核通过后工资自动汇总，无需手动统计。
如遇到“工价未设置”或“分工任务不存在”等提示，请联系管理员补充基础数据。
如需操作视频、详细截图、或有特殊业务流程（如扫码报工、批量导入、移动端适配等），请随时告知，我可为你定制更详细的操作手册或功能说明！


登录：POST /api/user/miniprogram_login （注意是 miniprogram_login，不是 login）
首页：GET /api/worker/index
任务列表：GET /api/worker/tasks
任务详情：GET /api/worker/report?id=xxx
提交报工：POST /api/worker/submit
图片上传：POST /api/worker/upload_image
报工记录：GET /api/worker/records
工资统计：GET /api/worker/wages

## 联系方式

如有问题或建议，请联系开发团队。 